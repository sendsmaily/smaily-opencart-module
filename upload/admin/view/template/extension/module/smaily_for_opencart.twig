{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="submit" form="form-smaily_for_opencart" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if error_warning %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" area-label="Close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if error_validate %}
      <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i>{{ error_validate }}
      <button type="button" class="close" area-label="Close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if error_autoresponder %}
      <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i>{{ error_autoresponder }}
      <button type="button" class="close" area-label="Close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if error_delay %}
      <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i>{{ error_delay }}
      <button type="button" class="close" area-label="Close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if error_limit %}
      <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i>{{ error_limit }}
      <button type="button" class="close" area-label="Close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if success %}
    <div class="alert alert-success"><i class="fa fa-exclamation-circle"></i> {{ success }}
      <button type="button" class="close" area-label="Close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="alert" id="validate-alert" hidden>
      <i class="fa fa-exclamation-circle"></i><span id="validate-message"></span>
      <button type="button" class="close" area-label="Close">&times;</button>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
      </div>
      <div class="panel-body">
      <input id="user_token" type="hidden" name="user_token" value="{{ user_token }}" />
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-smaily_for_opencart" class="form-horizontal">
          <!-- Generate tab nav for sections -->
          <div class="tab-pane">
            <ul class="nav nav-tabs" id="sections">
              {% for section in sections %}
              <li>
                <a href="#section{{ section.section_id }}" data-toggle="tab">{{ section.name }}</a>
              </li>
              {% endfor %}
            </ul>
            <div class="tab-content">
            <!-- Generate form content for each section -->
            <div id="section1" class="tab-pane fade in active">
            <div class="form-group">
            <label class="col-sm-2 control-label" for="input-status">{{ entry_enable_module_title }}</label>
            <div class="col-sm-10">
              <select name="module_smaily_for_opencart_status" id="input-status" class="form-control">
                {% if module_status %}
                <option value="1" selected="selected">{{ text_enabled }}</option>
                <option value="0">{{ text_disabled }}</option>
                {% else %}
                <option value="1">{{ text_enabled }}</option>
                <option value="0" selected="selected">{{ text_disabled }}</option>
                {% endif %}
              </select>
            </div>
          </div>
            <div class="form-group {{ validated ? 'has-success' : '' }} ">
              <label class="col-sm-2 control-label" for="module_smaily_for_opencart_subdomain">{{ subdomain_title }}</label>
              <div class="col-sm-10">
                <input type="text"
                       name="module_smaily_for_opencart_subdomain"
                       placeholder="{{ subdomain_placeholder }}"
                       id="subdomain"
                       value="{{ subdomain }}"
                       class="form-control" />
                <small>{{ small_subdomain }}</small>
                {% if error_subdomain %}
                    <div class="text-danger">{{ error_subdomain }}</div>
                {% endif %}
              </div>
            </div>
            <div class="form-group {{ validated ? 'has-success':'' }}">
              <label class="col-sm-2 control-label" for="module_smaily_for_opencart_username">{{ username_title }}</label>
              <div class="col-sm-10">
                <input type="text"
                       name="module_smaily_for_opencart_username"
                       placeholder="{{ username_placeholder }}"
                       id="username"
                       value="{{ username }}"
                       class="form-control" />
                {% if error_username %}
                    <div class="text-danger">{{ error_username }}</div>
                {% endif %}
              </div>
            </div>
            <div class="form-group {{ validated ? 'has-success' : '' }}">
              <label class="col-sm-2 control-label" for="module_smaily_for_opencart_password">{{ password_title }}</label>
              <div class="col-sm-10">
                <input type="password"
                       name="module_smaily_for_opencart_password"
                       placeholder="{{ password_placeholder }}"
                       id="password"
                       value="{{ password }}"
                       class="form-control" />
                <small><a href="https://smaily.com/help/api/general/create-api-user/" target="_blank">{{ small_password }}</a> </small>
                {% if error_password %}
                    <div class="text-danger">{{ error_password }}</div>
                {% endif %}
              </div>
            </div>
            <div class="form-group">
              <label
                class="col-sm-2 control-label"
                id="validate-title"
                {% if validated %} style="display: none;" {% endif %}
                >
                {{ validate_title }}
              </label>
              <label
                class="col-sm-2 control-label"
                id="reset-title"
                {% if not validated %} style="display: none;" {% endif %}
                >
                {{ reset_credentials_title }}
              </label>
              <div class="col-sm-10">
                <button
                  id="validate"
                  type="button"
                  title="{{ button_validate }}"
                  class="btn btn-primary"
                  {% if validated%} style="display: none;" {% endif %}
                >
                  {{ button_validate }}
                  <span id="smaily-validate-loader" hidden>
                    <i class="fa fa-spinner fa-spin" hidden></i>
                  </span>
                </button>
                <button
                  id="reset-credentials"
                  type="button"
                  title="{{ button_reset_credentials }}"
                  class="btn btn-primary"
                  {% if not validated%} style="display: none;" {% endif %}
                >
                  {{ button_reset_credentials }}
                  <span id="smaily-reset-loader" hidden>
                    <i class="fa fa-spinner fa-spin" hidden></i>
                  </span>
                </button>
              </div>
            </div>
            </div>
            <!-- Customer sync -->
            <div id="section2" class="tab-pane fade in">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-subscriber-status">{{ entry_enable_subscriber_title }}</label>
                <div class="col-sm-10">
                  <select name="module_smaily_for_opencart_enable_subscribe" id="input-subscriber-status" class="form-control">
                    {% if subscribe_status %}
                    <option value="1" selected="selected">{{ text_enabled }}</option>
                    <option value="0">{{ text_disabled }}</option>
                    {% else %}
                    <option value="1">{{ text_enabled }}</option>
                    <option value="0" selected="selected">{{ text_disabled }}</option>
                    {% endif %}
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="customer_sync_fields">{{ entry_customer_sync_fields_title }}</label>
                <div class="col-sm-10">
                  <select class="form-control" name="module_smaily_for_opencart_syncronize_additional[]" id="customer_sync_fields" multiple="multiple">
                    {# All available options #}
                    {% set sync_options = {
                      'firstname' : firstname,
                      'lastname' : lastname,
                      'telephone' : telephone,
                      'date_added' : date_added
                      }
                    %}
                    {# Add options for select  #}
                    {% for key, value in sync_options %}
                      {% if key in syncronize_additional %}
                        {% set selected = 'selected' %}
                      {% else %}
                        {% set selected = '' %}
                      {% endif %}
                      <option value='{{ key }}' {{ selected }}> {{ value }} </option>
                    {% endfor %}
                    </select>
                  <small>{{ small_sync_additional }}</small>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="module_smaily_for_opencart_sync_token">{{ sync_token_title }}</label>
                <div class="col-sm-10">
                  <input type="text"
                        name="module_smaily_for_opencart_sync_token"
                        placeholder="{{ sync_token_placeholder }}"
                        id="sync-token"
                        value="{{ sync_token }}"
                        class="form-control" />
                  <small>{{ small_token }}</small>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ sync_customer_url_title }}</label>
                <div class="col-sm-10">
                <p><strong>{{ customer_cron_url }}</strong></p>
                <p>{{ customer_cron_text }}</p>
                </div>
              </div>
          </div>
          <!-- Abandoned cart -->
            <div id="section3" class="tab-pane fade in">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-abandoned-status">{{ entry_enable_abandoned_title }}</label>
                <div class="col-sm-10">
                  <select name="module_smaily_for_opencart_enable_abandoned" id="input-abandoned-status" class="form-control">
                    {% if abandoned_status %}
                    <option value="1" selected="selected">{{ text_enabled }}</option>
                    <option value="0">{{ text_disabled }}</option>
                    {% else %}
                    <option value="1">{{ text_enabled }}</option>
                    <option value="0" selected="selected">{{ text_disabled }}</option>
                   {% endif %}
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="abandoned-autoresponder">{{ entry_autoresponder_title }}</label>
                <div class="col-sm-10">
                  <select name="module_smaily_for_opencart_abandoned_autoresponder" id="abandoned-autoresponder" class="form-control">
                    {% if abandoned_autoresponder %}
                      <option value='{{ abandoned_autoresponder|json_encode() }}'>
                        {{ abandoned_autoresponder.name }} - (selected)
                      </option>
                    {% else %}
                      <option value="">Select autoresponder</option>
                    {% endif %}
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="abandoned_sync_fields">{{ abandoned_sync_fields_title }}</label>
                <div class="col-sm-10">
                  <select class="form-control" name="module_smaily_for_opencart_abandoned_additional[]" id="abandoned_sync_fields" multiple="multiple">
                    {# All available options #}
                    {% set cart_options = {
                      'first_name'  : customer_first_name,
                      'last_name'   : customer_last_name,
                      'name'        : product_name,
                      'description' : product_description,
                      'sku'         : product_sku,
                      'quantity'    : product_quantity,
                      'price'       : product_price,
                      'base_price'  : product_base_price
                    } %}
                    {# Add options for select #}
                    {% for key, value in cart_options %}
                      {% if key in abandoned_additional %}
                        {% set selected = 'selected' %}
                      {% else %}
                        {% set selected = '' %}
                      {% endif %}
                      <option value='{{ key }}' {{ selected }}> {{ value }} </option>
                    {% endfor %}
                    </select>
                    <small>{{ small_cart_additional }}</small>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="module_smaily_for_opencart_cart_delay">{{ delay_title }}</label>
                <div class="col-sm-10">
                  <div class="input-group">
                    <input type="number"
                          name="module_smaily_for_opencart_cart_delay"
                          min="15"
                          id="module_smaily_for_opencart_cart_delay"
                          value="{{ cart_delay }}"
                          class="form-control" />
                    <span class="input-group-addon">{{ abandoned_minutes }}</span>
                  </div>
                  <small>{{ small_cart_delay }}</small>
                  {% if error_delay %}
                      <div class="text-danger">{{ error_delay }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="module_smaily_for_opencart_cart_token">{{ cart_token_title }}</label>
                <div class="col-sm-10">
                  <input type="text"
                        name="module_smaily_for_opencart_cart_token"
                        placeholder="{{ cart_token_placeholder }}"
                        id="cart-token"
                        value="{{ cart_token }}"
                        class="form-control" />
                  <small>{{ small_token }}</small>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ sync_cart_url_title }}</label>
                <div class="col-sm-10">
                <p><strong>{{ cart_cron_url }}</strong></p>
                <p>{{ cart_cron_text }}</p>
                </div>
              </div>
            </div>
            <!-- RSS -->
            <div id="section4" class="tab-pane fade in">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="rss-category">{{ rss_category_title }}</label>
                <div class="col-sm-10">
                  <select name="module_smaily_for_opencart_rss_category" id="rss-category" class="form-control smaily-rss-options">
                    <option value="">All Products</option>
                    {% for category in rss_categories %}
                      {% if category.category_id in rss_category %}
                        {% set selected = 'selected' %}
                      {% else %}
                        {% set selected = '' %}
                      {% endif %}
                      <option value='{{ category.category_id }}' {{ selected }}> {{ category.name }} </option>
                    {% endfor %}
                    </select>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="rss-sort-by">{{ rss_sort_by_title }}</label>
                <div class="col-sm-10">
                  <select name="module_smaily_for_opencart_rss_sort_by" id="rss-sort-by" class="form-control smaily-rss-options">
                  {# All available options #}
                    {% set sort_options = {
                      'pd.name' : name,
                      'p.model' : model,
                      'p.price' : price,
                      'p.status' : status,
                      'p.sort_order' : sort_order
                    } %}
                    {# Add options for select #}
                    {% for key, value in sort_options %}
                      {% if key in rss_sort_by %}
                        {% set selected = 'selected' %}
                      {% else %}
                        {% set selected = '' %}
                      {% endif %}
                      <option value='{{ key }}' {{ selected }}> {{ value }} </option>
                    {% endfor %}
                    </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="rss-sort-order">{{ rss_sort_order_title }}</label>
                <div class="col-sm-10">
                  <select name="module_smaily_for_opencart_rss_sort_order" id="rss-sort-order" class="form-control smaily-rss-options">
                    {% if rss_sort_order == 'ASC' %}
                      <option value="ASC" selected="selected">{{ text_ascending }}</option>
                      <option value="DESC">{{ text_descending }}</option>
                      {% else %}
                      <option value="ASC">{{ text_ascending }}</option>
                      <option value="DESC" selected="selected">{{ text_descending }}</option>
                    {% endif %}
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="module_smaily_for_opencart_rss_limit">{{ rss_limit_title }}</label>
                <div class="col-sm-10">
                  <div class="input-group">
                    <input type="number"
                          name="module_smaily_for_opencart_rss_limit"
                          min="1"
                          max="250"
                          id="rss-limit"
                          value="{{ rss_limit }}"
                          class="form-control smaily-rss-options" />
                    <span class="input-group-addon">{{ rss_limit_products }}</span>
                  </div>
                  {% if error_limit %}
                      <div class="text-danger">{{ error_limit }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ rss_feed_title }}</label>
                <div class="col-sm-10">
                  <p><strong id="smaily-rss-feed-url" name="rss_feed_url">{{ smaily_rss_url }}</strong></p>
                  <p>{{ rss_feed_text }}</p>
                </div>
              </div>
            </div>
            <div id="section5" class="tab-pane fade in">
              <div class="form-group">
                <table class="table table-bordered table-hover SmailyAbandonedCartsTable">
                  <thead>
                    <tr>
                      <th scope="col">{{ cart_status_table_header_id }}</th>
                      <th class="text-left">{% if sort == 'lastname' %}<a href="{{ sort_name }}" class="{{ order|lower }}">{{ cart_status_table_header_name }}</a>{% else %}<a href="{{ sort_name }}">{{ cart_status_table_header_name }}</a>{% endif %}</th>
                      <th class="text-left">{% if sort == 'email' %}<a href="{{ sort_email }}" class="{{ order|lower }}">{{ cart_status_table_header_email }}</a>{% else %}<a href="{{ sort_email }}">{{ cart_status_table_header_email }}</a>{% endif %}</th>
                      <th class="text-left">{{ cart_status_table_header_cart }}</th>
                      <th class="text-left">{% if sort == 'sent_time' %}<a href="{{ sort_date }}" class="{{ order|lower }}">{{ cart_status_table_header_date }}</a>{% else %}<a href="{{ sort_date }}">{{ cart_status_table_header_date }}</a>{% endif %}</th>
                      <th class="text-left">{% if sort == 'is_sent' %}<a href="{{ sort_status }}" class="{{ order|lower }}">{{ cart_status_table_header_status }}</a>{% else %}<a href="{{ sort_status }}">{{ cart_status_table_header_status }}</a>{% endif %}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for abandoned_cart in abandoned_cart_list %}
                    <tr>
                      <th scope="row">{{ abandoned_cart.customer_id }}</th>
                        <td>{{ abandoned_cart.firstname ~ " " ~ abandoned_cart.lastname}}</td>
                        <td>{{ abandoned_cart.email }}</td>
                      <td>
                        <table class="table table-bordered" >
                          <tbody >
                            {% for product in abandoned_cart.products %}
                            <tr>
                              <td width="70%"><a href={{ product_url_without_id ~ product.data.product_id }} /a>{{ product.data.name }}</td>
                              <td width="15%">{{ "x " ~ product.quantity }}</td>
                              <td width="15%">{{ "$" ~ product.data.price }}</td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </td>
                      <td>{{ abandoned_cart.sent_time ?: '' }}<br></td>
                      <td><b>{{ abandoned_cart.is_sent == '1' ? 'SENT' : 'PENDING' }}<b></td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <div class="row">
                  <div class="col-sm-6 text-left">{{ pagination }}</div>
                  <div class="col-sm-6 text-right">{{ results }}</div>
                </div>
              </div>
            </div>
            </div>
            </div> <!-- .tab-content -->
            </div> <!-- .tab-pane -->
          </form>
        </div> <!-- .panel-body -->
      </div>
    </div>
  </div>
  <script type="text/javascript">
    var smaily_rss_url_base = '{{ smaily_rss_url_base }}';
  </script>
  <link rel="stylesheet" type="text/css" href="view/stylesheet/smailyforopencart/abandoned_carts_table.css" />
{{ footer }}
</div>
